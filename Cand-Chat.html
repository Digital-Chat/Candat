<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Canned Tool</title>
<link rel="icon" href=https://us.123rf.com/450wm/desbayy/desbayy1809/desbayy180901438/107685339-ct-initial-letter-with-negative-space-logo-icon-vector-template.jpg>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --accent1:#4ea8ff;
  --accent2:#7c3aed;
  --warn:#FFD700;
  --footer-from:#251A40;
  --footer-to:#0B3559;
  --sidebar-w:300px;
  --splash-duration:1000ms;
}
[data-theme="light"]{
  --bg1:#f5f8fb;
  --bg2:#eef3fb;
  --card:#ffffff;
  --muted:#334155;
  --text:#0f1724;
}
[data-theme="dark"]{
  --bg1:#0b0f14;
  --bg2:#141226;
  --card:#1a1d29;
  --muted:#cbd5e1;
  --text:#e6f0ff;
}
html,body{
  height:100%;margin:0;padding:0;font-family:'Tajawal',sans-serif;direction:rtl;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--muted);-webkit-font-smoothing:antialiased;
}
/* Splash */
.splash{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;
background:var(--bg1);transition:opacity .3s ease;}
.splash-box{display:flex;flex-direction:column;align-items:center;gap:12px;}
.splash .gear{font-size:28px;animation:spin 1s linear infinite;}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

/* Header */
.header-wrap{position:fixed;top:0;left:0;right:0;height:38px;display:flex;align-items:center;z-index:120;
background:linear-gradient(90deg,var(--accent2),var(--accent1));box-shadow:0 6px 20px rgba(0,0,0,.45);}
.marquee{overflow:hidden;white-space:nowrap;width:100%;padding:6px 18px;}
.marquee .text{display:inline-block;white-space:nowrap;font-weight:800;color:var(--warn);font-size:13px;
text-shadow:0 0 10px rgba(255,215,0,.18);animation:moveLeft 14s linear infinite;}
@keyframes moveLeft{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}

/* Theme Toggle */
.theme-toggle{position:fixed;top:6px;left:12px;z-index:130;
background:linear-gradient(90deg,var(--accent1),var(--accent2));
border:none;color:white;padding:6px 8px;border-radius:7px;cursor:pointer;font-weight:800;}

/* Layout */
.app{display:flex;flex-direction:row-reverse;gap:20px;
padding:86px 20px 120px 20px;max-width:1400px;margin:0 auto;box-sizing:border-box;}
.sidebar{position:fixed;top:86px;right:20px;width:var(--sidebar-w);
background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
border-radius:12px;padding:14px;box-shadow:0 10px 30px rgba(2,6,23,.6);
border:1px solid rgba(255,255,255,.03);z-index:110;}
.upload-row{display:flex;gap:8px;align-items:center;}
.upload-btn{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;
border:none;cursor:pointer;color:#fff;background:linear-gradient(90deg,var(--accent1),var(--accent2));
font-weight:800;width:100%;}
.search-box{margin-top:12px;display:flex;align-items:center;gap:8px;
background:rgba(255,255,255,.02);padding:8px;border-radius:10px;
border:1px solid rgba(255,255,255,.02);}
.search-box input{flex:1;border:none;outline:none;background:transparent;
color:var(--text);font-size:14px;padding:6px;}
.sheet-list{margin-top:12px;display:flex;flex-direction:column;gap:8px;
max-height:56vh;overflow:auto;padding-right:6px;}
.sheet-item{padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700;
text-align:right;color:var(--text);border:1px solid rgba(255,255,255,.02);}
.sheet-item.active{background:linear-gradient(90deg,rgba(78,168,255,.12),rgba(124,58,237,.08));}

/* Main content */
.main{flex:1;min-height:60vh;margin-right:calc(var(--sidebar-w) + 60px);
background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));
border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,.08);
border:1px solid rgba(255,255,255,.02);}
.main-header{display:flex;justify-content:space-between;align-items:center;gap:10px;}
.main-header h2{margin:0;color:var(--text);font-size:18px;font-weight:800;}
.instructions{font-size:13px;color:rgba(255,255,255,.7);align-self:flex-start;margin-left:8px;}
.grid{margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:14px;align-items:stretch;}
@media(max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}.main{margin-right:340px}}
@media(max-width:640px){.app{flex-direction:column-reverse;padding-top:120px;}
.grid{grid-template-columns:1fr}.sidebar{position:relative;top:auto;right:auto;width:100%}
.main{margin-right:0}}
.card{border-radius:12px;border:1px solid rgba(255,255,255,.03);display:flex;flex-direction:column;
overflow:hidden;cursor:pointer;min-height:170px;transition:transform .18s,box-shadow .18s,opacity .35s;
background:var(--card);box-shadow:0 8px 18px rgba(0,0,0,.25);opacity:0;transform:translateY(6px);}
.card.visible{opacity:1;transform:translateY(0);}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 30px rgba(0,0,0,.35);}
.card-title{text-align:center;font-weight:800;font-size:15px;color:var(--accent1);
padding:12px 10px;border-bottom:1px dashed rgba(255,255,255,.02);}
.card-content{padding:12px;flex:1;overflow:hidden;display:flex;flex-direction:column;}
.frame p { margin: 2px 0; line-height: 1.3; }
.frame{background:rgba(255,255,255,.02);border-radius:8px;padding:10px;flex:1;
color:var(--text);font-size:13px;line-height:1.45;overflow:hidden;
display:-webkit-box;-webkit-line-clamp:6;-webkit-box-orient:vertical;text-overflow:ellipsis;}
.card-footer{padding:8px 12px;font-size:12px;color:rgba(255,255,255,.65);
border-top:1px solid rgba(255,255,255,.02);}
.empty{text-align:center;padding:28px;color:var(--muted);
background:rgba(255,255,255,.02);border-radius:8px;}
.footer-wrapper{position:fixed;left:0;right:0;bottom:0;z-index:100;}
.footer-bar{height:46px;background:linear-gradient(90deg,var(--footer-from),var(--footer-to));
display:flex;align-items:center;justify-content:center;box-shadow:0 -6px 20px rgba(11,53,89,.45);}
.footer-bar .text{color:#fff;font-weight:800;text-shadow:0 0 8px rgba(255,255,255,.06);font-size:14px;}
</style>
</head>
<body data-theme="dark">

<!-- Splash Screen -->
<div class="splash" id="splash">
  <div class="splash-box">
    <div class="gear">⚙️</div>
    <div style="font-weight:800;color:var(--text);">جارٍ تحميل الأداة...</div>
  </div>
</div>

<!-- Header -->
<div class="header-wrap">
  <div class="marquee">
    <span class="text">⚠️ مش محتاج أقولك إن استخدامك لأي كاند هو على مسؤوليتك الشخصية ولازم دايمًا تتأكد من الويكي ⚠️</span>
  </div>
</div>

<!-- Theme Toggle -->
<button class="theme-toggle" id="themeToggle">🌙</button>

<!-- Layout Wrapper -->
<div class="app">

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="upload-row">
      <button class="upload-btn" id="uploadBtn">📤 رفع ملف Excel</button>
      <input type="file" id="fileInput" accept=".xlsx" style="display:none">
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="🔍 ابحث داخل كل الشيتات...">
    </div>
    <div class="sheet-list" id="sheetList"></div>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="main-header">
      <h2 id="sheetTitle">📋 اختر صفحة من القائمة</h2>
      <span class="instructions">اضغط على أي مربع لنسخ الـ Content فقط</span>
    </div>
    <div class="grid" id="cardsGrid">
      <div class="empty">لا توجد نتائج مطابقة 🔍</div>
    </div>
  </div>

</div>

<!-- Footer -->
<div class="footer-wrapper">
  <div class="footer-bar">
    <div class="text">Designed and Developed By Geek @2025</div>
  </div>
</div>

<!-- Click sound Base64 -->
<audio id="clickSound">
  <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA..."
          type="audio/mp3">
</audio>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const splash = document.getElementById("splash");
  const sheetList = document.getElementById("sheetList");
  const cardsGrid = document.getElementById("cardsGrid");
  const fileInput = document.getElementById("fileInput");
  const uploadBtn = document.getElementById("uploadBtn");
  const searchInput = document.getElementById("searchInput");
  const clickSound = document.getElementById("clickSound");
  const themeToggle = document.getElementById("themeToggle");
  const sheetTitle = document.getElementById("sheetTitle");

  let workbookData = {};
  let currentSheet = null;

  // إخفاء شاشة التحميل
  setTimeout(() => splash.style.opacity = "0", 800);
  setTimeout(() => splash.style.display = "none", 1200);

  // تبديل الثيم
  themeToggle.addEventListener("click", () => {
    const current = document.body.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    document.body.setAttribute("data-theme", next);
    themeToggle.textContent = next === "dark" ? "🌙" : "☀️";
  });

  // تحميل تلقائي من نفس المجلد (لـ GitHub Pages)
  fetch('candat_data.xlsx')
    .then(resp => {
      if (!resp.ok) throw new Error("File not found");
      return resp.arrayBuffer();
    })
    .then(buffer => {
      const wb = XLSX.read(buffer, { type: "array" });
      handleWorkbook(wb);
    })
    .catch(() => console.log("لم يتم العثور على الملف - يمكنك رفعه يدويًا"));

  // رفع يدوي
  uploadBtn.addEventListener("click", () => fileInput.click());
  fileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      const data = new Uint8Array(evt.target.result);
      const wb = XLSX.read(data, { type: "array" });
      handleWorkbook(wb);
    };
    reader.readAsArrayBuffer(file);
  });

  // معالجة ملف Excel
  function handleWorkbook(wb) {
    workbookData = {};
    wb.SheetNames.forEach(name => {
      const ws = wb.Sheets[name];
      const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
      const items = [];
      // تجاهل الصف الأول (Name / Content)
      for (let i = 1; i < rows.length; i++) {
        if (rows[i][0] && rows[i][1]) {
          items.push({ name: rows[i][0], content: rows[i][1], sheet: name });
        }
      }
      workbookData[name] = items;
    });
    renderSheetList(wb.SheetNames);
    if (wb.SheetNames.length) showSheet(wb.SheetNames[0]);
  }

  // عرض أسماء الشيتات في القائمة
  function renderSheetList(names) {
    sheetList.innerHTML = "";
    names.forEach(name => {
      const btn = document.createElement("div");
      btn.className = "sheet-item";
      btn.textContent = name;
      btn.addEventListener("click", () => showSheet(name));
      sheetList.appendChild(btn);
    });
  }

  // عرض الشيت المحدد
  function showSheet(name) {
    currentSheet = name;
    document.querySelectorAll(".sheet-item").forEach(el => el.classList.remove("active"));
    [...sheetList.children].find(el => el.textContent === name)?.classList.add("active");
    sheetTitle.textContent = `📄 شيت: ${name}`;
    renderCards(workbookData[name]);
  }

  // عرض الكروت
  function renderCards(items) {
    cardsGrid.innerHTML = "";
    if (!items || !items.length) {
      cardsGrid.innerHTML = '<div class="empty">لا توجد نتائج مطابقة 🔍</div>';
      return;
    }
    items.forEach((item, index) => {
      const card = document.createElement("div");
      card.className = "card";

      const hasNewlines = (item.content.match(/\n/g) || []).length > 0;
      const formatted = hasNewlines 
        ? item.content.replace(/\n/g, "<p>&nbsp;</p>")
        : item.content;

      card.innerHTML = `
        <div class="card-title">${item.name}</div>
        <div class="card-content">
          <div class="frame">${formatted}</div>
        </div>
        <div class="card-footer">📄 من شيت: ${item.sheet}</div>`;

      card.addEventListener("click", () => {
        copyText(hasNewlines ? formatted : item.content);
        playClick();
      });

      cardsGrid.appendChild(card);
      setTimeout(() => card.classList.add("visible"), 100 + index * 40);
    });
  }

  // النسخ
  function copyText(text) {
    const temp = document.createElement("textarea");
    temp.value = text;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
  }

  // الصوت
  function playClick() {
    clickSound.currentTime = 0;
    clickSound.play();
  }

// بحث عالمي عبر كل الشيتات — يعرض اسم الشيت تحت كل كارت
searchInput.addEventListener("input", () => {
  const q = (searchInput.value || '').trim().toLowerCase();

  // لو الحقل فاضي: عرض الشيت الحالي (أو رسالة لو مفيش شيت محدد)
  if (!q) {
    if (currentSheet) {
      renderCards(workbookData[currentSheet] || []);
      sheetTitle.textContent = `📄 شيت: ${currentSheet}`;
    } else {
      cardsGrid.innerHTML = '<div class="empty">اختر شيت أو ارفع ملفًا للبدء</div>';
      sheetTitle.textContent = `📋 اختر صفحة من القائمة`;
    }
    return;
  }

  // نجمع كل النتائج من كل الشيتات
  const results = [];
  Object.keys(workbookData).forEach(sheetName => {
    (workbookData[sheetName] || []).forEach(item => {
      const hay = ((item.name || '') + ' ' + (item.content || '')).toString().toLowerCase();
      if (hay.includes(q)) {
        const copy = Object.assign({}, item);
        copy.sheet = sheetName; // ضمن أن خاصية sheet موجودة
        results.push(copy);
      }
    });
  });

  // عرض النتائج
  if (!results.length) {
    cardsGrid.innerHTML = '<div class="empty">لا توجد نتائج مطابقة 🔍</div>';
    sheetTitle.textContent = `نتائج البحث عن: "${searchInput.value.trim()}"`;
  } else {
    // عنوان البحث
    sheetTitle.textContent = `نتائج البحث عن: "${searchInput.value.trim()}" (${results.length})`;
    // عرض النتائج (تأكد أن renderCards يتعامل مع عناصر تحتوي على .sheet)
    renderCards(results);
  }
});
});
</script>
</body>
</html>
